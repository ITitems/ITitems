<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProjectDAO">

	<resultMap type="egovframework.let.prj.service.ProjectVO"
		id="ProjectList">
		<result property="prjId" column="PRJ_ID" />
		<result property="prjName" column="PRJ_NAME" />
		<result property="prjStart" column="PRJ_START" />
		<result property="prjEnd" column="PRJ_END" />
		<result property="id" column="ID" />
		<result property="client" column="CLIENT" />
		<result property="prjState" column="PRJ_STATE" />
		<result property="name" column="USER_NM" />
		<result property="position" column="CODE_NM" />
	</resultMap>
	
	<sql id="search">
		<where>
			<if test="searchWord != null and searchWord != ''">
				a.PRJ_NAME LIKE CONCAT ('%', #{searchWord},'%')
			</if>
		</where>
	</sql>
	
	<select id="SelectProjectVOList"
		parameterType="egovframework.let.prj.service.ProjectManageVO" resultMap="ProjectList">
		SELECT P.RUM,
			   P.PRJ_ID,
			   P.PRJ_NAME,
			   P.PRJ_START,
			   P.PRJ_END,
			   P.CLIENT,
			   P.PRJ_STATE,
			   P.USER_NM,
			   P.CODE_NM
		FROM   (
			   SELECT  ROW_NUMBER() OVER(ORDER BY a.PRJ_ID) AS RUM,
			   		   a.PRJ_ID, 
			   		   a.PRJ_NAME, 
			           DATE_FORMAT(a.PRJ_START,'%Y-%m-%d') AS PRJ_START,
			  		   DATE_FORMAT(a.PRJ_END,'%Y-%m-%d') AS PRJ_END,
			   		   a.CLIENT,
			   		   a.PRJ_STATE, 
			           b.USER_NM, 
			           c.CODE_NM
			   FROM    PROJECTS a LEFT OUTER JOIN LETTNEMPLYRINFO b
			   ON      a.ID = b.EMPLYR_ID LEFT OUTER JOIN LETTCCMMNDETAILCODE c
			   ON      b.GRADE = c.CODE
			   <include refid="search"></include>
			   ) P 
		WHERE  P.RUM BETWEEN #{first} AND #{last}
	</select>

	<select id="CountProjectVOList"
		parameterType="egovframework.let.prj.service.ProjectManageVO"
		resultType="int">
		SELECT COUNT(A.PRJ_ID)
		FROM   PROJECTS A
		<include refid="search"></include>
	</select>
	
	<select id="selectPrj" parameterType="egovframework.let.prj.service.ProjectManageVO" resultMap="ProjectList">
		SELECT 		A.PRJ_ID,
					A.PRJ_NAME,
					DATE_FORMAT(A.PRJ_START,'%Y-%m-%d') AS PRJ_START,
			  		DATE_FORMAT(A.PRJ_END,'%Y-%m-%d') AS PRJ_END,
					A.ID,
					A.CLIENT,
					A.PRJ_STATE,
					B.USER_NM
		FROM 		PROJECTS A
		LEFT JOIN 	LETTNEMPLYRINFO B
		ON 			A.ID = B.EMPLYR_ID
		WHERE		A.PRJ_ID = #{prjId}
	</select>
</mapper>